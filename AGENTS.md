# Agent Guidelines for Our Little Corner (Twofold)

This document provides context, conventions, and instructions for AI agents operating in this repository.

## 1. Project Overview & Tooling

**Stack:** Next.js 14 (App Router), TypeScript, Tailwind CSS, PostgreSQL (Raw SQL), Firebase Auth.

### Commands
- **Build:** `npm run build`
- **Dev Server:** `npm run dev`
- **Lint:** `npm run lint` (ESLint)
- **Test:** *Currently, no test framework is configured.*
  - **Action:** If asked to write tests, verify if the user wants to install Jest/Vitest first. Do not assume tests run.
  - **Future:** If tests are added, use `npm run test` (to be created).

### Configuration Files
- `package.json`: Dependencies and scripts.
- `tsconfig.json`: TypeScript configuration (Strict mode enabled).
- `tailwind.config.js`: Tailwind theme extensions (colors, animations).
- `CLAUDE.md`: High-level architecture and domain knowledge.

## 2. Code Style & Conventions

### TypeScript
- **Strict Mode:** Always on. Avoid `any` types. Define interfaces in `app/lib/types.ts` or local files if scoped narrowly.
- **Interfaces:** Prefix with `I` is **NOT** used. Use descriptive names (e.g., `Corner`, `MediaItem`).
- **Path Aliases:** Use `@/` to import from the `app` directory (e.g., `import { Button } from '@/components/ui/button'`).

### React Components (`app/components/`)
- **Format:** Functional components using `export default function ComponentName() { ... }`.
- **Hooks:** Use standard hooks (`useState`, `useEffect`) and custom contexts (`useAuth`, `useCorner`).
- **Styling:**
  - Use **Tailwind CSS** exclusively.
  - Use semantic colors (`text-primary`, `bg-muted`, `border-accent`) defined in the theme.
  - Use `clsx` or `tailwind-merge` (via `cn` utility) for conditional classes.
- **UI Library:** Shadcn UI components are located in `@/components/ui/`. Prefer using these over raw HTML elements.
- **Icons:** Use `lucide-react`.

### Database & Backend (`app/lib/`)
- **Pattern:** **Raw SQL** using `pg` (node-postgres).
- **Location:** Database logic resides in `app/lib/db.ts`.
- **Convention:**
  - **Do NOT** introduce an ORM (Prisma/Drizzle) unless explicitly requested.
  - Use the `query` helper function from `@/lib/db`.
  - Always use parameterized queries (`$1`, `$2`) to prevent SQL injection.
  - Handle errors using `try/catch` and log them with `console.error`.
- **Example:**
  ```typescript
  // Good
  const result = await query('SELECT * FROM corners WHERE id = $1', [id]);
  return result.rows[0];
  ```

### File Structure
- `app/`: Next.js App Router pages and layouts.
- `app/api/`: API routes (Route Handlers).
- `app/components/`: Reusable React components.
- `app/components/ui/`: Shadcn UI primitives.
- `app/lib/`: Utility functions, database logic, types.
- `app/contexts/`: React Context providers (Auth, Corner).

## 3. Implementation Rules

### 1. Modifying Code
- **Read First:** Always read the file and related imports before editing.
- **Match Style:** Replicate the existing coding style (indentation, spacing, naming).
- **Imports:** Group imports:
  1. External libraries (React, Next.js)
  2. Internal Contexts/Hooks
  3. UI Components
  4. Icons/Assets
- **Error Handling:** Ensure API routes and Server Actions return structured errors.

### 2. Creating New Features
- **UI:** Check `app/components/ui` first. Do not reinvent generic components (buttons, inputs, cards).
- **State:** Check `CornerContext` or `AuthContext` before creating local state if the data is global.
- **Async:** Use `async/await` for all asynchronous operations.

### 3. Naming Conventions
- **Files:**
  - Components: `PascalCase.tsx` (e.g., `CornerSelector.tsx`)
  - Utilities/Libs: `camelCase.ts` (e.g., `db.ts`, `auth.ts`)
- **Variables/Functions:** `camelCase`
- **Database Tables/Columns:** `snake_case` (e.g., `corner_users`, `is_public`)

## 4. Architecture Notes (from CLAUDE.md)
- **Multi-tenancy:** Data is isolated by `corner_id`. Always include this in queries unless doing an admin/global lookup.
- **Auth:** Firebase Auth + Custom JWT Session cookies. Middleware handles protection.
- **Storage:** Google Cloud Storage for media.

## 5. Common Tasks & Snippets

### Fetching Data (Server Side)
```typescript
import { query } from '@/lib/db';

async function getData(id: string) {
  const res = await query('SELECT * FROM table WHERE id = $1', [id]);
  return res.rows;
}
```

### Client Component Pattern
```typescript
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'

export default function Feature() {
  const [isLoading, setIsLoading] = useState(false)
  // ...
}
```

---
*Generated by opencode on Jan 28, 2026.*
